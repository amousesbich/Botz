<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Xit iOS Panel - Dynamic License Access</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* Global Reset and Font */
    * {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      box-sizing: border-box; 
    }
    body {
      background-color: #0d1a2d; 
      color: #e0f2f7; 
      padding: 20px;
      display: flex; 
      justify-content: center; 
      align-items: center; 
      min-height: 100vh; 
    }

    /* MAIN CONTAINER (Login/Panel) */
    .login, .painel {
      max-width: 400px;
      background-color: rgba(23, 37, 56, 0.9); 
      backdrop-filter: blur(8px); 
      -webkit-backdrop-filter: blur(8px); 
      padding: 25px; 
      border-radius: 25px; 
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.4), 
                  0 0 0 1px rgba(255, 255, 255, 0.08); 
      position: relative; 
      z-index: 10;
      border: 1px solid rgba(255, 255, 255, 0.1); 
    }
    .login {
        flex-shrink: 0; 
    }
    
    /* COUNTDOWN STYLING - Login Screen */
    #countdownDisplay {
      text-align: center;
      margin-top: 15px;
      margin-bottom: 5px;
      font-size: 18px;
      font-weight: bold;
      color: #ff6e6e; 
      display: none; 
    }
    #countdownDisplay.error {
        color: #ff6e6e;
    }
    
    /* PANEL COUNTDOWN STYLING */
    #panelCountdownDisplay {
        margin-top: 25px;
        padding: 10px 15px;
        border-radius: 10px;
        background-color: rgba(97, 218, 251, 0.1); 
        border: 1px solid #61dafb;
        text-align: center;
        font-weight: 600;
        color: #61dafb;
        font-size: 14px;
    }
    #panelCountdownDisplay.ending {
        background-color: rgba(255, 110, 110, 0.1);
        border: 1px solid #ff6e6e;
        color: #ff6e6e;
        animation: blink-red 1s infinite alternate;
    }
    @keyframes blink-red {
        from { opacity: 1; }
        to { opacity: 0.7; }
    }


    /* INPUT FIELD */
    input[type="text"], input[type="password"] {
      background-color: rgba(45, 62, 80, 0.7); 
      color: #e0f2f7;
      border-radius: 12px;
      padding: 12px 15px; 
      margin: 12px 0;
      font-size: 16px;
      border: 1px solid rgba(255, 255, 255, 0.15); 
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
      width: 100%; 
    }
    input[type="text"]:focus, input[type="password"]:focus {
      outline: none;
      border-color: #61dafb; 
      box-shadow: 0 0 0 2px rgba(97, 218, 251, 0.2); 
    }
    input::placeholder {
      color: rgba(224, 242, 247, 0.5); 
    }

    /* BUTTON */
    button {
      width: 100%; 
      background-color: #61dafb; 
      color: #0d1a2d; 
      font-weight: bold;
      cursor: pointer;
      border-radius: 12px;
      padding: 12px 15px;
      margin-top: 20px;
      font-size: 17px;
      transition: background-color 0.3s ease, transform 0.2s ease;
      border: none;
    }
    button:hover {
      background-color: #4ed4f2; 
      transform: translateY(-2px); 
    }
    button:active {
      transform: translateY(0);
    }
    button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
    }

    /* TOGGLE SWITCHES */
    .toggle {
      background-color: rgba(45, 62, 80, 0.7); 
      border-radius: 15px; 
      padding: 12px 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 10px 0;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2); 
    }
    .toggle span {
      font-size: 15px;
      color: #cce7ed; 
    }
    .switch {
      width: 44px; 
      height: 26px; 
      background: #4a6580; 
      border-radius: 13px; 
      position: relative;
      cursor: pointer;
      flex-shrink: 0;
      transition: background 0.3s ease, opacity 0.3s ease;
    }
    .switch::before {
      content: '';
      width: 20px; 
      height: 20px; 
      background: #e0f2f7; 
      border-radius: 50%;
      position: absolute;
      top: 3px;
      left: 3px; 
      transition: all 0.3s ease;
      box-shadow: 0 1px 3px rgba(0,0,0,0.3); 
    }
    .switch.active {
      background: #61dafb; 
    }
    .switch.active::before {
      left: 21px; 
    }
    
    /* TOGGLE LOADING EFFECT */
    .switch.disabled {
        opacity: 0.6;
        cursor: not-allowed;
        pointer-events: none; 
        animation: pulse 1s infinite alternate; 
    }
    @keyframes pulse {
        from { opacity: 0.5; }
        to { opacity: 1; }
    }

    /* SUB-HEADER */
    h3 {
      margin-top: 30px;
      margin-bottom: 15px;
      font-size: 19px;
      color: #61dafb; 
      font-weight: 600;
      letter-spacing: 0.3px;
      display: flex; 
      align-items: center;
    }
    h3::before {
      content: '‚öôÔ∏è'; 
      margin-right: 8px;
      font-size: 20px;
    }
    
    /* SLIDERS */
    .slider-container {
      margin: 18px 0; 
    }
    .slider-label {
      display: flex; 
      justify-content: space-between;
      margin-bottom: 8px; 
      font-size: 15px;
      color: #cce7ed;
    }
    .slider-label span {
        font-weight: 600; 
        color: #61dafb; 
        min-width: 40px; 
        text-align: right;
    }
    
    input[type=range] {
      width: 100%;
      -webkit-appearance: none; 
      height: 6px; 
      background: #4a6580; 
      border-radius: 3px; 
      outline: none; 
      opacity: 0.8; 
      -webkit-transition: .2s ease; 
      transition: opacity .2s ease;
    }
    input[type=range]::-webkit-slider-thumb {
      -webkit-appearance: none; 
      appearance: none;
      width: 20px; 
      height: 20px; 
      border-radius: 50%; 
      background: #61dafb; 
      cursor: pointer; 
      margin-top: -7px; 
      box-shadow: 0 2px 5px rgba(0,0,0,0.3); 
      transition: background-color 0.3s ease;
    }
    
    /* CSS FOR GAME LAUNCH */
    .game-launch-container {
        display: flex;
        gap: 10px; 
        margin-top: 15px;
    }
    .game-launch-btn {
        flex: 1; 
        padding: 15px 10px;
        margin-top: 0px; 
        font-size: 16px;
        background-color: #4a6580; 
        color: #e0f2f7;
        border: 2px solid #61dafb; 
        transition: background-color 0.3s ease, transform 0.2s ease, border-color 0.3s;
    }
    .game-launch-btn:hover {
        background-color: #5c7996;
        transform: translateY(-2px);
    }
    .game-launch-btn.max {
        background-color: #ff6e6e; 
        border-color: #ff3c3c;
        color: white;
    }
    .game-launch-btn.max:hover {
        background-color: #ff8585;
    }
    
    /* Manual Reset/Save Button */
    .action-button {
        width: 100%;
        margin-top: 15px;
        font-size: 15px;
        padding: 10px;
        border-radius: 10px;
        font-weight: 500;
        background-color: #4a6580;
        color: #e0f2f7;
        border: 1px solid #cce7ed;
    }
    .action-button:hover {
        background-color: #5c7996;
    }

    /* Particles.js styling */
    #particles-js {
      position: fixed; 
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      z-index: 1; 
      background-color: #0d1a2d; 
    }
    
    /* --- CSS UNTUK HEADER DAN NAVBAR --- */
    .hamburger-header {
        display: flex;
        position: relative; 
        justify-content: center; 
        align-items: center;
        margin-bottom: 25px;
        padding: 0 40px; 
    }
    .hamburger-icon {
        font-size: 28px;
        cursor: pointer;
        color: #61dafb;
        padding: 5px;
        transition: color 0.3s;
        position: absolute;
        left: 0; 
        top: 0; 
        z-index: 20; 
    }
    .hamburger-icon:hover {
        color: #4ed4f2;
    }
    .panel-title {
        font-size: 24px;
        font-weight: 600;
        letter-spacing: 0.5px;
        color: #61dafb;
        text-align: center;
        margin: 0; 
        padding: 0;
        flex-grow: 1; 
    }

    .navbar-menu {
        display: none; 
        flex-direction: column;
        width: 60%; 
        margin-left: -25px; 
        margin-top: -15px;
        margin-bottom: 20px;
        border: 1px solid rgba(97, 218, 251, 0.2);
        border-radius: 10px;
        padding: 10px;
        background-color: rgba(23, 37, 56, 0.95); 
        box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.5);
        position: absolute; 
        top: 50px; 
        left: 25px; 
        z-index: 15;
        animation: slideInLeft 0.3s ease-out;
    }
    .navbar-menu.show {
        display: flex; 
    }
    @keyframes slideInLeft {
        from { opacity: 0; transform: translateX(-20px); }
        to { opacity: 1; transform: translateX(0); }
    }

    .nav-link {
        color: #e0f2f7;
        text-decoration: none;
        font-size: 15px;
        font-weight: 500;
        padding: 10px 15px;
        border-radius: 8px;
        margin: 4px 0;
        transition: background-color 0.3s ease, color 0.3s ease;
        background-color: rgba(45, 62, 80, 0.5); 
        text-align: center;
    }
    .nav-link:hover {
        background-color: #61dafb;
        color: #0d1a2d;
    }
    .nav-link.logout {
        color: #ff6e6e;
        border: 1px solid #ff6e6e;
    }
    .nav-link.logout:hover {
        background-color: #ff6e6e;
        color: white;
    }
    
    /* --- CSS UNTUK MODAL PROFIL (Lebih Menarik) --- */
    .modal-overlay {
        display: none; 
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7); 
        backdrop-filter: blur(5px);
        -webkit-backdrop-filter: blur(5px);
        z-index: 100; 
        justify-content: center;
        align-items: center;
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .modal-overlay.show {
        display: flex;
        opacity: 1;
    }

    .profile-modal-content {
        background-color: rgba(23, 37, 56, 0.95);
        padding: 30px;
        border-radius: 20px;
        width: 90%;
        max-width: 350px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        transform: translateY(20px);
        transition: transform 0.3s ease;
        border: 1px solid rgba(255, 255, 255, 0.1);
        position: relative; 
    }

    .modal-overlay.show .profile-modal-content {
        transform: translateY(0);
    }

    .modal-header {
        text-align: center;
        margin-bottom: 25px;
    }

    .modal-header h3 {
        margin: 0;
        font-size: 24px;
        color: #61dafb;
        font-weight: 700;
    }

    .avatar-icon {
        font-size: 48px;
        color: #e0f2f7;
        margin-bottom: 10px;
        display: block;
    }

    .profile-info {
        margin-bottom: 25px;
        background-color: rgba(45, 62, 80, 0.7);
        padding: 15px;
        border-radius: 15px;
        border: 1px solid rgba(97, 218, 251, 0.2);
    }

    .profile-info-item {
        display: flex;
        justify-content: space-between;
        padding: 8px 0;
        font-size: 15px;
        border-bottom: 1px dashed rgba(255, 255, 255, 0.1);
    }

    .profile-info-item:last-child {
        border-bottom: none;
    }

    .profile-info-item strong {
        color: #61dafb;
    }

    .modal-button {
        width: 100%;
        padding: 12px;
        border-radius: 12px;
        font-weight: bold;
        font-size: 16px;
        cursor: pointer;
        margin-top: 10px;
        border: none;
        transition: all 0.2s;
    }

    .modal-button.logout-btn {
        background-color: #ff6e6e;
        color: white;
    }

    .modal-button.logout-btn:hover {
        background-color: #ff3c3c;
        transform: translateY(-1px);
    }

    .modal-close-btn {
        position: absolute;
        top: 15px;
        right: 15px;
        background: none;
        border: none;
        font-size: 24px;
        color: #e0f2f7;
        cursor: pointer;
        transition: color 0.2s;
        line-height: 1;
    }

    .modal-close-btn:hover {
        color: #ff6e6e;
    }

  </style>
  
<script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
</head>
<body>

<div id="particles-js"></div> 

<div class="login" id="loginScreen">
  <h2>Login</h2>
  <input type="text" id="user" placeholder="User">
  <input type="password" id="pass" placeholder="Pass">
  <div id="countdownDisplay"></div> 
  <button id="loginButton" onclick="logar()">Enter</button>
</div>

<div class="painel" id="painelScreen" style="display:none;">
    
    <div class="hamburger-header">
        <span class="hamburger-icon" onclick="toggleNavbar()">‚ò∞</span>
        <h2 class="panel-title">Xit iOS Panel - WILZzXD</h2>
    </div>

    <div class="navbar-menu" id="navbarMenu">
        <a href="#" class="nav-link" id="profileLink" onclick="handleNavClick('profile')">üë§ Profil</a>
        <a href="#" class="nav-link" onclick="handleNavClick('settings')">‚öôÔ∏è Settings</a>
        <a href="#" class="nav-link logout" onclick="logout()">üö™ Logout</a>
    </div>

  <div class="toggle"><span>Automatic Scan</span><div class="switch" id="toggle_scan" onclick="toggle(this)"></div></div>
  <div class="toggle"><span>Pause at First Item</span><div class="switch" id="toggle_pause" onclick="toggle(this)"></div></div>
  <div class="toggle"><span>Aim Cycles</span><div class="switch" id="toggle_cycles" onclick="toggle(this)"></div></div>
  <div class="toggle"><span>Long Press (ADS)</span><div class="switch" id="toggle_ads" onclick="toggle(this)"></div></div>
  <div class="toggle"><span>Extended Predictions</span><div class="switch" id="toggle_extended" onclick="toggle(this)"></div></div>
  <div class="toggle"><span>Ignore Repetition</span><div class="switch" id="toggle_repeat" onclick="toggle(this)"></div></div>

  <h3>Advanced Functions</h3> 

  <div class="toggle"><span>Directional Aimbot</span><div class="switch" id="toggle_aimbot" onclick="toggle(this)"></div></div>
  <div class="toggle"><span>Aimlock V2</span><div class="switch" id="toggle_aimlock" onclick="toggle(this)"></div></div>
  <div class="toggle"><span>Anti-Ban Bypass</span><div class="switch" id="toggle_bypass" onclick="toggle(this)"></div></div>
  <div class="toggle"><span>Stable Red Dot</span><div class="switch" id="toggle_reddot" onclick="toggle(this)"></div></div>
  <div class="toggle"><span>No Recoil</span><div class="switch" id="toggle_recoil" onclick="toggle(this)"></div></div>
  <div class="toggle"><span>Speed x2</span><div class="switch" id="toggle_speed" onclick="toggle(this)"></div></div>
  <div class="toggle"><span>Legit Mode</span><div class="switch" id="toggle_legit" onclick="toggle(this)"></div></div>

  <div class="slider-container">
    <div class="slider-label">
        <label for="sensibilidade">Aim Sensitivity</label>
        <span id="sensibilidadeValue">60%</span> 
    </div>
    <input type="range" id="sensibilidade" min="0" max="100" value="60" oninput="updateSliderValue('sensibilidade')">
  </div>
  <div class="slider-container">
    <div class="slider-label">
        <label for="adsControl">Recoil Control</label>
        <span id="adsControlValue">75%</span> 
    </div>
    <input type="range" id="adsControl" min="0" max="100" value="75" oninput="updateSliderValue('adsControl')">
  </div>
  
  <button class="action-button" onclick="resetSettings()">RESET SETTINGS</button>

  <h3 style="margin-top: 40px;">Select Game Version</h3>

  <div class="game-launch-container">
    <button class="game-launch-btn" onclick="launchGame('FF_Normal')">
        FREE FIRE NORMAL üöÄ
    </button>
    <button class="game-launch-btn max" onclick="launchGame('FF_MAX')">
        FREE FIRE MAX üî•
    </button>
  </div>
  
  <div id="panelCountdownDisplay">
      Lisensi Aktif. Menghitung mundur...
  </div>
</div>

<div class="modal-overlay" id="profileModal">
    <div class="profile-modal-content">
        <button class="modal-close-btn" onclick="closeModal('profileModal')">‚úï</button>
        
        <div class="modal-header">
            <span class="avatar-icon">üë§</span>
            <h3 id="modalUsername">Loading...</h3>
        </div>

        <div class="profile-info">
            <div class="profile-info-item">
                <span>Status Lisensi:</span>
                <strong id="modalLicenseStatus">Aktif</strong>
            </div>
            <div class="profile-info-item">
                <span>Berakhir Dalam:</span>
                <strong id="modalExpiryTime">Menghitung...</strong>
            </div>
            <div class="profile-info-item">
                <span>ID Perangkat:</span>
                <strong style="color: #cce7ed; font-size: 13px;">#1389-XIT-A</strong>
            </div>
        </div>

        <button class="modal-button" style="background-color: #61dafb; color: #0d1a2d;" onclick="closeModal('profileModal')">
            ‚öôÔ∏è Edit Settings
        </button>
        <button class="modal-button logout-btn" onclick="logout()">
            üö™ Logout User
        </button>
    </div>
</div>

<audio id="clickSoundOff" src="https://raw.githubusercontent.com/amousesbich/Botz/main/click_off.mp3" preload="auto"></audio>
<audio id="clickSoundOn" src="https://raw.githubusercontent.com/amousesbich/Botz/main/ssstik.io_1762140484965.mp3" preload="auto"></audio>
<script>
  // --- KONSTANTA KONFIGURASI LOGIN ---
  const GITHUB_RAW_URL = 'https://raw.githubusercontent.com/amousesbich/Botz/main/TOKEN.txt';
  const DEFAULT_DURATION_HOURS = 24; 
  
  let countdownIntervalLogin = null; 
  let countdownIntervalPanel = null; 
  let activeUser = ''; 
  let licenseExpiryTime = 0; 
  // ------------------------------------

  const ALL_CONTROLS = [
    'toggle_scan', 'toggle_pause', 'toggle_cycles', 'toggle_ads', 
    'toggle_extended', 'toggle_repeat', 'toggle_aimbot', 'toggle_aimlock',
    'toggle_bypass', 'toggle_reddot', 'toggle_recoil', 'toggle_speed', 'toggle_legit',
    'sensibilidade', 'adsControl'
  ];

  // --- FUNGSI AUDIO UNTUK MENGATASI AUTOPLAY POLICY ---

  function unlockAudio() {
    // Dipanggil setelah interaksi pengguna pertama (klik tombol login)
    const soundOn = document.getElementById('clickSoundOn');
    
    // Coba putar suara sejenak untuk 'membuka' izin audio
    // Gunakan try-catch karena ini bisa gagal di beberapa browser
    soundOn.volume = 0; 
    soundOn.play().then(() => {
        soundOn.pause();
        soundOn.currentTime = 0;
        soundOn.volume = 1; // Kembalikan volume normal setelah izin didapat
    }).catch(e => {
        console.warn("Audio unlock failed, browser still blocking:", e);
    });
  }

  function playClick(state) {
    const soundOn = document.getElementById('clickSoundOn');
    const soundOff = document.getElementById('clickSoundOff');
    
    if (state === 'on') { 
        soundOn.currentTime = 0; 
        soundOn.play().catch(e => { console.error("Error playing ON sound:", e); }); 
    } else { 
        soundOff.currentTime = 0; 
        soundOff.play().catch(e => { console.error("Error playing OFF sound:", e); }); 
    }
  }

  // --- FUNGSI NAVBAR TOGGLE & MODAL ---

    function toggleNavbar() {
        const navbar = document.getElementById('navbarMenu');
        navbar.classList.toggle('show');
        playClick(navbar.classList.contains('show') ? 'on' : 'off');
    }

    function updateProfileLink(username) {
        const profileLink = document.getElementById('profileLink');
        if (profileLink) {
            profileLink.innerHTML = `üë§ Profil (${username})`;
        }
    }

    function logout() {
        playClick('off');
        
        const licenseKey = `wilzxd_LICENSE_EXPIRY_${activeUser}`;
        const durationKey = `wilzxd_REMAINING_DURATION_${activeUser}`;
        
        if (countdownIntervalPanel && licenseExpiryTime > 0) {
            clearInterval(countdownIntervalPanel);
            
            const currentTime = new Date().getTime();
            const remainingDurationMs = licenseExpiryTime - currentTime;
            
            if (remainingDurationMs > 0) {
                localStorage.setItem(durationKey, remainingDurationMs); 
            }
            
            localStorage.removeItem(licenseKey); 
        }
        window.location.reload();
    }

    function handleNavClick(menu) {
        playClick('on');
        document.getElementById('navbarMenu').classList.remove('show'); 
        
        if (menu === 'profile') {
            openProfileModal(); 
        } else if (menu === 'settings') {
            alert('‚öôÔ∏è Settings menu selected. (This section currently shows the main controls.)');
        }
    }

    function openProfileModal() {
        if (!activeUser) {
            alert('Silakan login terlebih dahulu.');
            closeModal('profileModal');
            return;
        }

        const modal = document.getElementById('profileModal');
        const user = activeUser;
        
        document.getElementById('modalUsername').textContent = user;

        const expiryTimeMs = licenseExpiryTime;
        const currentTime = new Date().getTime();
        
        let status = 'Error';
        let expiryText = 'N/A';
        
        const statusElement = document.getElementById('modalLicenseStatus');
        const expiryElement = document.getElementById('modalExpiryTime');

        if (expiryTimeMs > 0) {
            const remainingTimeMs = expiryTimeMs - currentTime;

            if (remainingTimeMs > 0) {
                status = '‚úÖ AKTIF';
                
                const totalSeconds = Math.floor(remainingTimeMs / 1000);
                const hours = Math.floor(totalSeconds / 3600);
                const minutes = Math.floor((totalSeconds % 3600) / 60);

                expiryText = `${hours}j ${minutes}m`;
                
                if (remainingTimeMs < 60 * 60 * 1000) {
                    expiryElement.style.color = '#ff6e6e';
                } else {
                    expiryElement.style.color = '#61dafb';
                }
                statusElement.style.color = '#79ff6e';

            } else {
                status = '‚ùå KADALUWARSA';
                expiryText = 'Hubungi Admin';
                statusElement.style.color = '#ff6e6e';
                expiryElement.style.color = '#ff6e6e';
            }
        } else {
            status = '‚ö†Ô∏è TIDAK DITEMUKAN';
            statusElement.style.color = '#ff6e6e';
            expiryElement.style.color = '#e0f2f7';
            expiryText = 'N/A';
        }
        
        statusElement.textContent = status;
        expiryElement.textContent = expiryText;
        
        modal.classList.add('show');
    }

    function closeModal(modalId) {
        const modal = document.getElementById(modalId);
        modal.classList.remove('show');
        playClick('off');
    }
  // --------------------------------


  // --- FUNGSI COUNTDOWN & LOGIN ---

  function startPanelCountdown(expiryTime) {
      if (countdownIntervalPanel) {
          clearInterval(countdownIntervalPanel);
      }
      
      licenseExpiryTime = expiryTime; 

      const panelDisplay = document.getElementById('panelCountdownDisplay');
      panelDisplay.classList.remove('ending');

      countdownIntervalPanel = setInterval(() => {
          const currentTime = new Date().getTime();
          const remainingTimeMs = licenseExpiryTime - currentTime; 

          if (remainingTimeMs <= 0) {
              clearInterval(countdownIntervalPanel);
              panelDisplay.textContent = "LISENSI HABIS! SILAKAN LOGIN KEMBALI.";
              panelDisplay.classList.add('ending');
              
              const key = `wilzxd_LICENSE_EXPIRY_${activeUser}`;
              localStorage.removeItem(key); 
              
              setTimeout(() => { 
                alert("Lisensi Anda telah habis. Harap login ulang.");
                window.location.reload(); 
              }, 3000);
              return;
          }

          const totalSeconds = Math.floor(remainingTimeMs / 1000);
          const hours = Math.floor(totalSeconds / 3600);
          const minutes = Math.floor((totalSeconds % 3600) / 60);
          const seconds = totalSeconds % 60;

          const h = String(hours).padStart(2, '0');
          const m = String(minutes).padStart(2, '0');
          const s = String(seconds).padStart(2, '0');
          
          panelDisplay.textContent = `LISENSI AKTIF. Berakhir dalam: ${h}j ${m}m ${s}d`;

          if (remainingTimeMs < 60 * 60 * 1000) {
            panelDisplay.classList.add('ending');
          }

      }, 1000);
  }

  function updateCountdown(expiryTime) {
      if (countdownIntervalLogin) {
          clearInterval(countdownIntervalLogin);
      }
      
      const countdownDisplay = document.getElementById('countdownDisplay');
      const loginButton = document.getElementById('loginButton');
      countdownDisplay.style.display = 'block';

      countdownIntervalLogin = setInterval(() => {
          const currentTime = new Date().getTime();
          const remainingTimeMs = expiryTime - currentTime;

          if (remainingTimeMs <= 0) {
              clearInterval(countdownIntervalLogin);
              countdownDisplay.classList.remove('success');
              countdownDisplay.classList.add('error');
              countdownDisplay.textContent = "Lisensi telah kedaluwarsa! Silakan hubungi admin.";
              loginButton.disabled = true;
              return;
          }

          const totalSeconds = Math.floor(remainingTimeMs / 1000);
          const hours = Math.floor(totalSeconds / 3600);
          const minutes = Math.floor((totalSeconds % 3600) / 60);
          const seconds = totalSeconds % 60;

          const h = String(hours).padStart(2, '0');
          const m = String(minutes).padStart(2, '0');
          const s = String(seconds).padStart(2, '0');

          countdownDisplay.classList.add('error');
          countdownDisplay.textContent = `Lisensi berakhir dalam: ${h}j ${m}m ${s}d`;
          loginButton.disabled = false;
      }, 1000);
  }

  async function logar() {
    const user = document.getElementById('user').value.trim();
    const pass = document.getElementById('pass').value.trim();
    
    if (user === '' || pass === '') {
        alert('Please enter both username and password.');
        return;
    }
    
    document.getElementById('loginScreen').style.opacity = 0.5;
    
    try {
      const response = await fetch(GITHUB_RAW_URL);
      if (!response.ok) { alert('Error: Could not retrieve user list from server.'); return; }
      
      const dataText = await response.text();
      const credentials = dataText.split('\n');
      let loginSuccessful = false;
      let licenseDurationHours = 0;

      for (let i = 0; i < credentials.length; i++) {
          const line = credentials[i].trim();
          const parts = line.split(',');
          
          let creds = '';
          let duration = DEFAULT_DURATION_HOURS; 

          if (parts.length >= 1) {
              creds = parts[0].trim();
              if (parts.length === 2 && !isNaN(parseInt(parts[1]))) {
                  duration = parseInt(parts[1].trim());
              }
          }

          if (creds === `${user}:${pass}`) {
              loginSuccessful = true;
              licenseDurationHours = duration;
              break;
          }
      }
      
      if (loginSuccessful) {
        
        const licenseKey = `wilzxd_LICENSE_EXPIRY_${user}`;
        const durationKey = `wilzxd_REMAINING_DURATION_${user}`;
        const savedRemainingDuration = localStorage.getItem(durationKey); 
        const currentTime = new Date().getTime(); 
        let finalExpiryTime;

        if (savedRemainingDuration) {
            finalExpiryTime = currentTime + parseInt(savedRemainingDuration);
            
            localStorage.removeItem(durationKey); 
            localStorage.setItem(licenseKey, finalExpiryTime);
            
        } else if (localStorage.getItem(licenseKey)) {
            finalExpiryTime = parseInt(localStorage.getItem(licenseKey));
            if (finalExpiryTime <= currentTime) {
                localStorage.removeItem(licenseKey); 
                document.getElementById('loginScreen').style.opacity = 1;
                document.getElementById('loginButton').disabled = true;
                updateCountdown(finalExpiryTime); 
                return; 
            }
        } else {
            const licenseDurationMs = licenseDurationHours * 60 * 60 * 1000; 
            finalExpiryTime = currentTime + licenseDurationMs;
            localStorage.setItem(licenseKey, finalExpiryTime); 
        }

        // --- UNLOCK AUDIO SETELAH INTERAKSI PENGGUNA ---
        unlockAudio();
        // --- END UNLOCK AUDIO ---

        if (countdownIntervalLogin) { clearInterval(countdownIntervalLogin); }

        activeUser = user; 
        updateProfileLink(user); 

        document.getElementById('loginScreen').style.display = 'none';
        document.getElementById('painelScreen').style.display = 'block';
        playClick('on'); 
        
        const msgDurationHours = Math.ceil((finalExpiryTime - currentTime) / (60 * 60 * 1000));
        let alertMessage = '';
        if (savedRemainingDuration) {
             alertMessage = `Welcome back, ${user}! Your access has been resumed. Remaining time: approx ${msgDurationHours} hours.`;
        } else {
             alertMessage = `Welcome, ${user}! Your access will expire in ${msgDurationHours} hours.`;
        }
        alert(alertMessage);
       
        startPanelCountdown(finalExpiryTime);

      } else {
        alert('Invalid login credentials.');
      }

    } catch (error) {
      alert('A network error occurred during login. Please try again.');
      console.error('Network or processing error:', error);
    } finally {
        if (document.getElementById('countdownDisplay').style.display !== 'block') {
            document.getElementById('loginScreen').style.opacity = 1;
        }
    }
  }

  // --- FUNGSI PENDUKUNG ---

  window.onload = function() {
    document.getElementById('loginScreen').style.display = 'block';
    document.getElementById('painelScreen').style.display = 'none';
    
    particlesJS('particles-js', {
        "particles": { "number": { "value": 100, "density": { "enable": true, "value_area": 1000 } }, "color": { "value": "#61dafb" }, "shape": { "type": "circle" }, "opacity": { "value": 0.4, "random": true }, "size": { "value": 2, "random": true }, "line_linked": { "enable": true, "distance": 120, "color": "#8be9fd", "opacity": 0.3, "width": 1 }, "move": { "enable": true, "speed": 2, "direction": "none", "random": true, "straight": false, "out_mode": "out", "bounce": false } },
        "interactivity": { "detect_on": "canvas", "events": { "onhover": { "enable": true, "mode": "grab" }, "onclick": { "enable": true, "mode": "push" }, "resize": true }, "modes": { "grab": { "distance": 140, "line_linked": { "opacity": 0.7 } }, "push": { "particles_nb": 4 } } },
        "retina_detect": true
    });
    
    loadSettings(); 
  };
  
  // --- FUNGSI PENGATURAN (SETTINGS) ---

  function saveSettings() {
    const settings = {};
    ALL_CONTROLS.forEach(id => {
      const element = document.getElementById(id);
      if (element) {
        if (element.classList.contains('switch')) {
          settings[id] = element.classList.contains('active');
        } else if (element.type === 'range') {
          settings[id] = element.value;
        }
      }
    });
    try {
      localStorage.setItem('wilzxd_settings', JSON.stringify(settings));
    } catch (e) { console.error("Failed to save settings:", e); }
  }

  function loadSettings() {
    try {
        const savedSettings = JSON.parse(localStorage.getItem('wilzxd_settings'));
        if (savedSettings) {
            ALL_CONTROLS.forEach(id => {
                const element = document.getElementById(id);
                if (element && savedSettings.hasOwnProperty(id)) {
                    if (element.classList.contains('switch')) {
                        if (savedSettings[id]) {
                            element.classList.add('active');
                        } else {
                            element.classList.remove('active');
                        }
                    } else if (element.type === 'range') {
                        element.value = savedSettings[id];
                        updateSliderValue(id, false); 
                    }
                }
            });
        }
    } catch (e) { console.error("Failed to load settings:", e); }
  }

  function updateSliderValue(id, shouldSave = true) {
    const slider = document.getElementById(id);
    const valueSpan = document.getElementById(id + 'Value');
    valueSpan.textContent = slider.value + '%';
    if(shouldSave) saveSettings();
  }

  function resetSettings() {
    if (confirm("Are you sure you want to reset all settings to their default values?")) {
        localStorage.removeItem('wilzxd_settings');
        window.location.reload(); 
    }
  }

  function toggle(el) {
    if (el.classList.contains('disabled')) return; 
    el.classList.add('disabled');
    const willBeActive = !el.classList.contains('active'); 
    
    const soundState = willBeActive ? 'on' : 'off';

    setTimeout(() => { 
        playClick(soundState); 
        
        el.classList.toggle('active');
        saveSettings(); 
        el.classList.remove('disabled');
        alert('Setting successfully ' + (willBeActive ? 'activated.' : 'deactivated.'));
    }, 1500); 
  }
  
  function launchGame(version) {
      playClick('on'); 
      let url = '';
      let msg = '';
      if (version === 'FF_Normal') {
          url = 'freefire://'; 
          msg = 'Configuration applied. Launching Free Fire Normal...';
      } else if (version === 'FF_MAX') {
          url = 'freefiremax://'; 
          msg = 'Configuration applied. Launching Free Fire MAX...';
      }
      if (url) {
          alert('Applying cheat configuration... Please wait 1.5 seconds.'); 
          setTimeout(() => {
              alert(msg); 
              window.open(url, '_blank'); 
          }, 1500); 
      }
  }

</script>

</body>
</html>
